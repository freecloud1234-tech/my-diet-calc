<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é£²é£Ÿç‡Ÿé¤Šç­†è¨˜</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a73e8">

<style>
:root { --primary:#1a73e8; --bg:#f8f9fa; }
body { font-family:-apple-system,sans-serif; background:var(--bg); margin:0; padding:15px; }
.container { max-width:500px; margin:auto; background:#fff; padding:20px; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,.1); }
.summary { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; background:#e8f0fe; padding:15px; border-radius:10px; text-align:center; margin-top:10px; }
.summary b { color:var(--primary); font-size:1.2em; }
.input-box { display:flex; flex-direction:column; gap:8px; border:2px solid #ddd; padding:15px; border-radius:10px; margin-top:15px; }
input,select,button { padding:12px; border-radius:8px; border:1px solid #ccc; font-size:16px; }
button { background:var(--primary); color:#fff; border:none; font-weight:bold; cursor:pointer; }
.log-item { display:flex; justify-content:space-between; border-bottom:1px dotted #ccc; padding:8px 0; }
small { color:#555; }
</style>
</head>

<body>
<div class="container">
<h2 style="text-align:center;margin:0;">ğŸ é£²é£Ÿç‡Ÿé¤Šç´€éŒ„</h2>

<input type="date" id="datePicker">

<input type="number" id="calGoal" placeholder="æ¯æ—¥ç†±é‡ç›®æ¨™ (kcal)" style="margin-top:10px;">

<div class="summary">
  <div>ç†±é‡<b id="total-cal">0</b></div>
  <div>è›‹ç™½<b id="total-pro">0</b></div>
  <div>ç¢³æ°´<b id="total-carb">0</b></div>
</div>

<div class="input-box">
  <input id="food-name" list="food-options" placeholder="é¸æ“‡é£Ÿç‰©">
  <datalist id="food-options"></datalist>

  <div style="display:flex;gap:5px;">
    <input type="number" id="food-amount" placeholder="æ•¸é‡" style="flex:2">
    <select id="food-unit" style="flex:1.5">
      <option value="ä»½">ä»½ / é¡†</option>
      <option value="g">å…¬å…‹(g)</option>
      <option value="ç¢—">ç¢—(200g)</option>
    </select>
  </div>

  <button onclick="addLog()">åŠ å…¥ç´€éŒ„</button>
</div>

<div id="log-list"></div>
</div>

<script>
/* ===== æ—¥æœŸå·¥å…· ===== */
const dateKey = d => {
  const x = new Date(d);
  return x.getFullYear() + '-' +
    String(x.getMonth()+1).padStart(2,'0') + '-' +
    String(x.getDate()).padStart(2,'0');
};

/* ===== é£Ÿç‰©è³‡æ–™åº« ===== */
const baseDB = {
  "è·åŒ…è›‹":[106,7,0.5],
  "èŒ¶è‘‰è›‹":[75,7,1],
  "æ°´ç…®è›‹":[75,7,1],

  "ç…è›‹åå¸ (å»é‚Šä¸åŠ é†¬)":[280,12,35],
  "é‡Œè‚Œè›‹åå¸ (å»é‚Šä¸åŠ é†¬)":[350,22,36],
  "è‚‰é¬†è›‹åå¸ (å»é‚Šä¸åŠ é†¬)":[380,15,42],

  "é»‘èƒ¡æ¤’éµæ¿éºµ":[650,18,85],
  "åŸå‘³è›‹é¤…":[260,10,30],
  "è±¬æ’è›‹é¤…":[420,22,32],
  "è‚‰é¬†è›‹é¤…":[350,14,38],
  "è±¬æ’è›‹æ¼¢å ¡":[480,24,45],

  "æ§è‚‰æ›åŒ…":[450,18,50],
  "ç„¡ç³–è±†æ¼¿":[35,3.5,1],

  "è–¯æ³¥ä¸¹éº¥åå¸":[420,8,55],
  "é®ªé­šæ²™æ‹‰ä¸¹éº¥åå¸":[450,16,48],
  "èµ·å¸è›‹ä¸¹éº¥åå¸":[400,14,40],

  "å£½å–œç‰›äº”èŠ±é¤ç›’":[650,28,75],
  "éº»å©†ç‰›äº”èŠ±é¤ç›’":[700,25,80],
  "é±¸é­šé¤ç›’":[550,35,70],
  "é’è”¥æµ·é¹½é›èƒ¸è‚‰é¤ç›’":[500,40,65],
  "äº”é¦™è—¥è†³å«©é›è…¿é¤ç›’":[620,32,68],
  "æ‰“æ‹‹ç‰›é¤ç›’":[680,30,75],
  "ç«çƒ¤æŒªå¨é¯–é­šé¤ç›’":[650,30,70],

  "7-11è’¸åœ°ç“œ":[120,1,28],
  "å…¨å®¶çƒ¤åœ°ç“œ":[120,1,28],

  "æ»·é›è…¿":[200,25,2],
  "æ»·å¤§é›è…¿":[300,35,3],
  "ç‚¸é›è…¿":[350,22,15],
  "ç‚¸å¤§é›è…¿":[500,32,25],
  "è±¬è…³":[250,18,1],
  "æ»·è±¬æ’":[220,22,5],
  "ç‚¸è±¬æ’":[380,20,25],

  "ç™½é£¯":[130,2,28],
  "é»‘ç±³é£¯":[140,3,30],
  "ç³™ç±³é£¯":[110,2,24],
  "ç´«ç±³é£¯":[150,3,32],
  "äº”ç©€é£¯":[120,3,26],

  "é¦™è•‰":[90,1,23],
  "èŠ­æ¨‚":[40,1,10],
  "åœ°ç“œè‘‰":[28,3,4],
  "é«˜éº—èœ":[25,1,6]
};

/* ===== ç‹€æ…‹ ===== */
let db = JSON.parse(localStorage.getItem('DB')) || baseDB;
let logs = JSON.parse(localStorage.getItem('LOGS')) || {};
let currentDate = dateKey(new Date());

datePicker.value = currentDate;

/* ===== ç†±é‡ç›®æ¨™ ===== */
let calGoal = localStorage.getItem('CAL_GOAL') || "";
calGoalInput = document.getElementById('calGoal');
calGoalInput.value = calGoal;
calGoalInput.onchange = e => {
  calGoal = e.target.value;
  localStorage.setItem('CAL_GOAL', calGoal);
};

/* ===== åˆå§‹åŒ– ===== */
renderOptions();
loadDay(currentDate);

/* ===== æ—¥æœŸåˆ‡æ› ===== */
datePicker.onchange = e => {
  currentDate = e.target.value;
  loadDay(currentDate);
};

function loadDay(d){
  if(!logs[d]) logs[d] = [];
  render();
}

function save(){
  localStorage.setItem('LOGS', JSON.stringify(logs));
  localStorage.setItem('DB', JSON.stringify(db));
}

/* ===== æ–°å¢ç´€éŒ„ ===== */
function addLog(){
  const n = food-name.value;
  const a = parseFloat(food-amount.value);
  const u = food-unit.value;
  if(!db[n] || !a) return alert("è«‹é¸æ“‡é£Ÿç‰©èˆ‡æ•¸é‡");

  let r = a;
  if(u==="g") r = a/100;
  if(u==="ç¢—") r = a*2;

  const [c,p,cb] = db[n];
  logs[currentDate].push({
    id:Date.now(),
    name:n,
    cal:Math.round(c*r),
    pro:(p*r).toFixed(1),
    carb:(cb*r).toFixed(1),
    show:a+u
  });

  save(); render();
  food-name.value=""; food-amount.value="";
}

/* ===== é¡¯ç¤º ===== */
function render(){
  const list = document.getElementById('log-list');
  list.innerHTML="";
  let tc=0,tp=0,tcab=0;

  logs[currentDate].forEach(i=>{
    tc+=i.cal; tp+=+i.pro; tcab+=+i.carb;
    list.innerHTML+=`
    <div class="log-item">
      <div><b>${i.name}</b> (${i.show})<br>
      <small>ğŸ”¥${i.cal} P:${i.pro} C:${i.carb}</small></div>
      <button onclick="delLog(${i.id})">âœ–</button>
    </div>`;
  });

  total-cal.textContent = tc;
  total-pro.textContent = tp.toFixed(1);
  total-carb.textContent = tcab.toFixed(1);

  if(calGoal && tc >= calGoal){
    alert(`âš ï¸ å·²è¶…éæ¯æ—¥ç†±é‡ç›®æ¨™ ${calGoal} kcal`);
    calGoal = "";
  }
}

/* ===== åˆªé™¤ ===== */
function delLog(id){
  logs[currentDate] = logs[currentDate].filter(i=>i.id!==id);
  save(); render();
}

/* ===== é£Ÿç‰©é¸å–® ===== */
function renderOptions(){
  food-options.innerHTML = Object.keys(db)
    .map(n=>`<option value="${n}">`).join("");
}

/* ===== PWA ===== */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}
</script>
</body>
</html>
