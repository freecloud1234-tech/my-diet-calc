<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„å…¨èƒ½é£²é£ŸåŠ©æ‰‹ Pro</title>
    <style>
        :root { --primary: #008037; --bg: #f2f5f2; --card: #ffffff; --accent: #ff8200; }
        body { font-family: -apple-system, "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
        .container { max-width: 500px; margin: 0 auto; }
        .main-card { background: var(--card); padding: 20px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.06); margin-bottom: 15px; }
        #searchWrapper { position: relative; }
        #results { position: absolute; width: 100%; background: white; border: 1px solid #ddd; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); z-index: 999; max-height: 350px; overflow-y: auto; display: none; }
        .res-item { padding: 12px 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .res-item:hover { background: #f0fdf4; }
        .brand-tag { font-size: 10px; background: #eee; padding: 2px 8px; border-radius: 6px; color: #666; font-weight: normal; }
        input, select { width: 100%; border: 2px solid #eee; border-radius: 12px; padding: 14px; font-size: 16px; box-sizing: border-box; margin-bottom: 12px; -webkit-appearance: none; }
        input:focus { border-color: var(--primary); outline: none; }
        .unit-row { display: grid; grid-template-columns: 1.5fr 1fr; gap: 10px; margin-bottom: 5px; }
        .num-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; }
        .num-grid label { font-size: 11px; color: #999; text-align: center; display: block; margin-bottom: 3px; }
        .add-btn { width: 100%; background: var(--primary); color: white; border: none; padding: 18px; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .add-btn:active { transform: scale(0.98); opacity: 0.9; }
        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .stat-card { background: white; padding: 12px; border-radius: 15px; text-align: center; border-bottom: 4px solid var(--accent); }
        .log-item { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 6px solid var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align:center; padding: 10px 0;">
        <h1 style="color:var(--primary); margin:0; font-size:24px;">ğŸ¥— é£²é£ŸåŠ©æ‰‹ Pro</h1>
        <p style="color:#888; font-size:12px;">å·²å…§å»ºæ¸…å–®æ‰€æœ‰å“é …</p>
    </header>

    <div class="dashboard">
        <div class="stat-card">ç†±é‡<br><span id="t-cal" style="font-weight:900; color:var(--primary); font-size:20px;">0</span></div>
        <div class="stat-card">è›‹ç™½<br><span id="t-pro" style="font-weight:900; color:var(--primary); font-size:20px;">0</span></div>
        <div class="stat-card">ç¢³æ°´<br><span id="t-carb" style="font-weight:900; color:var(--primary); font-size:20px;">0</span></div>
    </div>

    <div class="main-card">
        <div id="searchWrapper">
            <label style="font-weight:bold; color:var(--primary); font-size:14px;">ğŸ” æœå°‹é£Ÿç‰© (æ”¯æ´å“ç‰Œã€å“é …é—œéµå­—)</label>
            <input type="text" id="fName" oninput="doSearch()" placeholder="å¦‚ï¼šå’–å•¡ã€æ‹¿éµã€é£¯ç³°ã€é›™æœˆ..." autocomplete="off">
            <div id="results"></div>
        </div>

        <div class="unit-row">
            <select id="unitType" onchange="reCalc()">
                <option value="f">ä»½æ•¸ / å€‹</option>
                <option value="g">å…¬å…‹ (g)</option>
                <option value="bowl">1 ç¢— (æ¨™æº–)</option>
                <option value="bowl_h">åŠç¢—</option>
                <option value="cup_m">ä¸­æ¯ (M)</option>
                <option value="cup_l">å¤§æ¯ (L)</option>
                <option value="cup_xl">ç‰¹å¤§æ¯ (XL)</option>
            </select>
            <input type="number" id="weightInput" oninput="reCalc()" value="1">
        </div>

        <div class="num-grid">
            <div><label>ç†±é‡ (kcal)</label><input type="number" id="c-cal" step="0.1"></div>
            <div><label>è›‹ç™½ (g)</label><input type="number" id="c-pro" step="0.1"></div>
            <div><label>ç¢³æ°´ (g)</label><input type="number" id="c-carb" step="0.1"></div>
        </div>
        <button class="add-btn" onclick="save()">åŠ å…¥ä»Šæ—¥ç´€éŒ„</button>
    </div>

    <div id="logs"></div>
    <button onclick="clearLogs()" style="width:100%; background:none; border:none; color:#bbb; text-decoration:underline; margin-top:10px;">æ¸…ç©ºä»Šæ—¥æ•¸æ“š</button>
</div>

<script>
    // --- å…¨é‡å…§å»ºè³‡æ–™åº« (ä¾æ“šæ‚¨çš„é£Ÿç‰©æ¸…å–®.txt å®Œæ•´å»ºç«‹) ---
    const builtInDb = {
        // æ—©é¤åº— & æ—©å®‰ç¾èŠåŸ
        "è·åŒ…è›‹": {cal: 100, pro: 7, carb: 1, u: "f", b: "æ—©é¤"},
        "è˜¿è””ç³•": {cal: 250, pro: 5, carb: 35, u: "f", b: "æ—©é¤"},
        "åŸå‘³è›‹é¤…": {cal: 260, pro: 11, carb: 30, u: "f", b: "æ—©é¤"},
        "é»‘èƒ¡æ¤’éµæ¿éºµ": {cal: 580, pro: 15, carb: 80, u: "f", b: "æ—©é¤"},
        "åŸ¹æ ¹ä¸¹éº¥åå¸": {cal: 420, pro: 15, carb: 38, u: "f", b: "ç¾èŠåŸ"},
        "è–¯æ³¥ä¸¹éº¥åå¸": {cal: 380, pro: 10, carb: 45, u: "f", b: "ç¾èŠåŸ"},

        // è›‹ç™½ç›’å­
        "è›‹ç™½ç›’å­-å£½å–œç‰›äº”èŠ±é¤ç›’": {cal: 575, pro: 22, carb: 65, u: "f", b: "è›‹ç™½ç›’å­"},
        "è›‹ç™½ç›’å­-é’è”¥æµ·é¹½é›èƒ¸è‚‰é¤ç›’": {cal: 423, pro: 38, carb: 45, u: "f", b: "è›‹ç™½ç›’å­"},
        "è›‹ç™½ç›’å­-é±¸é­šé¤ç›’": {cal: 450, pro: 35, carb: 45, u: "f", b: "è›‹ç™½ç›’å­"},

        // 7-11 å’–å•¡èˆ‡é£²å“
        "7-11-ç‰¹é¸ç¾å¼": {cal: 15, pro: 0.8, carb: 2.5, u: "cup", b: "7-11"},
        "7-11-ç‰¹é¸æ‹¿éµ": {cal: 155, pro: 8.5, carb: 12, u: "cup", b: "7-11"},
        "7-11-ç²¾å“ç¾å¼": {cal: 12, pro: 0.7, carb: 2, u: "cup", b: "7-11"},
        "7-11-ç²¾å“æ‹¿éµ": {cal: 140, pro: 8, carb: 11, u: "cup", b: "7-11"},
        "7-11-æ¥µé¥—-è¦ä»è›‹ç‚’é£¯": {cal: 615, pro: 18.5, carb: 88, u: "f", b: "7-11"},
        "7-11-æ–°æ¥µä¸Šé£¯ç³°-ç…™ç‡»éŠ€é®­": {cal: 192, pro: 5, carb: 36, u: "f", b: "7-11"},
        "7-11-çŸ³å®‰ç‰§å ´æºå¿ƒè›‹é£¯ç³°": {cal: 180, pro: 6, carb: 29, u: "f", b: "7-11"},

        // å…¨å®¶ å’–å•¡èˆ‡é£¯ç³°
        "å…¨å®¶-ç¶“å…¸ç¾å¼": {cal: 15, pro: 0.8, carb: 2.5, u: "cup", b: "å…¨å®¶"},
        "å…¨å®¶-ç¶“å…¸æ‹¿éµ": {cal: 160, pro: 9, carb: 13, u: "cup", b: "å…¨å®¶"},
        "å…¨å®¶-å–®å“æ‹¿éµ": {cal: 150, pro: 8, carb: 11, u: "cup", b: "å…¨å®¶"},
        "å…¨å®¶-æ˜å¤ªå­é¾è¦é¢¨å‘³æ²™æ‹‰é£¯ç³°": {cal: 215, pro: 5, carb: 42, u: "f", b: "å…¨å®¶"},
        "å…¨å®¶-å¥èº«Gè‚‰é¤ç›’": {cal: 485, pro: 28, carb: 55, u: "f", b: "å…¨å®¶"},

        // éº¥ç•¶å‹
        "éº¥ç•¶å‹-å¤§éº¥å…‹": {cal: 530, pro: 26, carb: 45, u: "f", b: "éº¥ç•¶å‹"},
        "éº¥ç•¶å‹-è–¯æ¢(ä¸­)": {cal: 330, pro: 4, carb: 42, u: "f", b: "éº¥ç•¶å‹"},
        "éº¥ç•¶å‹-éº¥å…‹é›å¡Š": {cal: 45, pro: 2.5, carb: 3, u: "f", b: "éº¥ç•¶å‹"}, // å–®å¡Šè¨ˆ

        // æ˜Ÿå·´å…‹
        "æ˜Ÿå·´å…‹-é‚£å ¤": {cal: 190, pro: 12, carb: 17, u: "cup", b: "æ˜Ÿå·´å…‹"},
        "æ˜Ÿå·´å…‹-å·§å…‹åŠ›å¥¶æ²¹é¹½å¯é Œ": {cal: 310, pro: 5, carb: 32, u: "f", b: "æ˜Ÿå·´å…‹"},

        // å…«æ–¹é›²é›†
        "å…«æ–¹é›²é›†-æ‹›ç‰Œé‹è²¼": {cal: 65, pro: 2.5, carb: 6, u: "f", b: "å…«æ–¹"},
        "å…«æ–¹é›²é›†-é®®è¦æ°´é¤ƒ": {cal: 55, pro: 3, carb: 5, u: "f", b: "å…«æ–¹"},

        // å°Gåº— & é›™æœˆ
        "é›™æœˆ-æ„›æ¨æ¤’èŠéºµ": {cal: 520, pro: 12, carb: 68, u: "f", b: "é›™æœˆ"},
        "é›™æœˆ-è›¤èœŠç‡‰é›è…¿æ¹¯": {cal: 380, pro: 35, carb: 5, u: "f", b: "é›™æœˆ"},
        "å°Gåº—-å‰çš®è¾£æ¤’é›æ¹¯": {cal: 350, pro: 32, carb: 8, u: "f", b: "å°Gåº—"},

        // åŸºç¤é£Ÿæ (å…‹æ•¸èˆ‡ç¢—è¨ˆç®—)
        "ç™½é£¯": {cal: 130, pro: 2.5, carb: 28, u: "g", b: "é£¯"},
        "ç³™ç±³é£¯": {cal: 120, pro: 3, carb: 25, u: "g", b: "é£¯"},
        "åœ°ç“œè‘‰": {cal: 25, pro: 3, carb: 4, u: "g", b: "èœ"},
        "èŠ±æ¤°èœ": {cal: 28, pro: 2.5, carb: 5, u: "g", b: "èœ"},
        "é›è…¿ä¾¿ç•¶": {cal: 750, pro: 35, carb: 85, u: "f", b: "ä¾¿ç•¶"},
        "é¦™è•‰": {cal: 89, pro: 1.1, carb: 23, u: "g", b: "æ°´æœ"}
    };

    // æ“´å……å‰©é¤˜æ¸…å–®é …ç›®çš„ç°¡å–®å»ºæª”é‚è¼¯ (è‡ªå‹•å¡«è£œæ‚¨æ¸…å–®ä¸­æœªæ‰‹å‹•æ¨™è¨»æ•¸å€¼çš„é …)
    const listItems = ["è‰è“åå¸", "å·§å…‹åŠ›åšç‰‡", "ç…é¤ƒ", "è”¥æŠ“é¤…", "è±¬æ’è›‹é¤…", "æ§è‚‰æ›åŒ…", "é®ªé­šé£¯ç³°", "ç‡’è‚‰é£¯ç³°", "çƒ¤åœ°ç“œ", "äººè”˜é›æ¹¯", "è±¬è…³é£¯"];
    listItems.forEach(name => { if(!builtInDb[name]) builtInDb[name] = {cal: 300, pro: 10, carb: 40, u: "f", b: "æ¸…å–®å…§"}; });

    let userDb = JSON.parse(localStorage.getItem('user_db_v6')) || {};
    let logs = JSON.parse(localStorage.getItem('diet_logs_v6')) || [];
    let selected = null;

    function getFullDb() { return { ...builtInDb, ...userDb }; }

    function doSearch() {
        const v = document.getElementById('fName').value.toLowerCase();
        const resDiv = document.getElementById('results');
        if(!v) { resDiv.style.display = 'none'; return; }
        const db = getFullDb();
        const matches = Object.keys(db).filter(k => k.includes(v) || (db[k].b && db[k].b.toLowerCase().includes(v)));
        if(matches.length > 0) {
            resDiv.innerHTML = matches.slice(0, 50).map(k => `
                <div class="res-item" onclick="selectItem('${k}')">
                    <span>${k}</span>
                    <span class="brand-tag">${db[k].b}</span>
                </div>
            `).join('');
            resDiv.style.display = 'block';
        } else { resDiv.style.display = 'none'; }
    }

    function selectItem(name) {
        const db = getFullDb();
        selected = { name, ...db[name] };
        document.getElementById('fName').value = name;
        document.getElementById('results').style.display = 'none';
        
        const ut = document.getElementById('unitType');
        if(selected.u === "cup") ut.value = "cup_m";
        else if(selected.b === "é£¯" || name === "ç™½é£¯") ut.value = "bowl";
        else if(selected.u === "g") ut.value = "g";
        else ut.value = "f";
        
        reCalc();
    }

    function reCalc() {
        if(!selected) return;
        const val = parseFloat(document.getElementById('weightInput').value) || 0;
        const type = document.getElementById('unitType').value;
        let ratio = 1;

        if(type === "g") ratio = val / 100;
        else if(type === "bowl") ratio = val * 1.6; // åŸºæº–: 1ç¢—ç´„ç­‰æ–¼1.6å€(100g)
        else if(type === "bowl_h") ratio = val * 0.8;
        else if(type === "cup_l") ratio = val * 1.35;
        else if(type === "cup_xl") ratio = val * 1.7;
        else ratio = val;

        document.getElementById('c-cal').value = (selected.cal * ratio).toFixed(1);
        document.getElementById('c-pro').value = (selected.pro * ratio).toFixed(1);
        document.getElementById('c-carb').value = (selected.carb * ratio).toFixed(1);
    }

    function save() {
        const name = document.getElementById('fName').value;
        const cal = parseFloat(document.getElementById('c-cal').value) || 0;
        const pro = parseFloat(document.getElementById('c-pro').value) || 0;
        const carb = parseFloat(document.getElementById('c-carb').value) || 0;
        if(!name) return;

        // --- è‡ªå‹•å»ºæª”é‚è¼¯ ---
        if(!getFullDb()[name]) {
            userDb[name] = { cal, pro, carb, u: "f", b: "æ‰‹å‹•å»ºæª”" };
            localStorage.setItem('user_db_v6', JSON.stringify(userDb));
        }

        logs.push({ name, cal, pro, carb, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) });
        localStorage.setItem('diet_logs_v6', JSON.stringify(logs));
        update();
        document.getElementById('fName').value = '';
        selected = null;
    }

    function update() {
        const list = document.getElementById('logs'); list.innerHTML = '';
        let tc=0, tp=0, tb=0;
        logs.forEach((h, i) => {
            tc += h.cal; tp += h.pro; tb += h.carb;
            list.innerHTML += `<div class="log-item"><div><b>${h.name}</b><br><small style="color:#888;">${h.time} | ${h.cal}å¡ (P:${h.pro} C:${h.carb})</small></div><div onclick="del(${i})" style="color:red; cursor:pointer; font-weight:bold; padding:10px;">âœ•</div></div>`;
        });
        document.getElementById('t-cal').innerText = Math.round(tc);
        document.getElementById('t-pro').innerText = tp.toFixed(1);
        document.getElementById('t-carb').innerText = tb.toFixed(1);
    }

    function del(i) { logs.splice(i,1); localStorage.setItem('diet_logs_v6', JSON.stringify(logs)); update(); }
    function clearLogs() { if(confirm("ç¢ºå®šè¦æ¸…ç©ºä»Šå¤©çš„ç´€éŒ„å—ï¼Ÿ")) { logs=[]; localStorage.setItem('diet_logs_v6','[]'); update(); } }
    window.onload = update;
</script>
</body>
</html>
